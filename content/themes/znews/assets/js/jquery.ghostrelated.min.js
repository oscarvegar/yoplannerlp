!function(t){function e(e,r){this.element=e,this.options=t.extend({},defaults,r),this.parseRss()}defaults={feed:"/rss",titleClass:".post-title",tagsClass:".post-meta",limit:5,debug:!1},e.prototype.displayRelated=function(e){var r=this,n=0;this._currentPostTags=this.getCurrentPostTags(this.options.tagsClass);var o=this.matchByTag(this._currentPostTags,e);o.forEach(function(e){n<r.options.limit&&t(r.element).append(t('<li><a href="'+e.url+'">'+e.title+"</a></li>")),n++}),0==n&&t(this.element).append(t('<p>No related posts were found. Check the <a href="/">index</a>.</p>'))},e.prototype.parseRss=function(e,r,n){var o=e||1,r=r||"",n=n||[],s=this;t.ajax({url:this.options.feed+"/"+o,type:"GET"}).done(function(e){var i=t(e).find("item > guid").text();if(i!=r)n.push(e),s.parseRss(o+1,i,n);else{var a=s.getPosts(n);s.displayRelated(a)}}).fail(function(t){s.reportError(t)})},e.prototype.getCurrentPostTitle=function(e){"."!=e[0]&&(e="."+e);var r=t(e).text();return r.length<1&&this.reportError("Couldn't find the post title with class: "+e),r},e.prototype.getCurrentPostTags=function(e){"."!=e[0]&&(e="."+e);var r=[];return t(e+" a").each(function(){r.push(t(this).text())}),r.length<1&&this.reportError("Couldn't find any tags in this post"),r},e.prototype.getPosts=function(e){var r=[],n=[];e.forEach(function(e){n=t.merge(n,t(e).find("item"))});for(var o=0;o<n.length;o++){var s=t(n[o]);s.find("title").text()!==this.getCurrentPostTitle(this.options.titleClass)&&r.push({title:s.find("title").text(),url:s.find("link").text(),content:s.find("description").text(),tags:t.map(s.find("category"),function(e){return t(e).text()})})}return r.length<1&&this.reportError("Couldn't find any posts in feed: "+feed),r},e.prototype.matchByTag=function(t,e){var r=[];return e.forEach(function(e){var n=!1;e.tags.forEach(function(o){t.forEach(function(t){t.toLowerCase()!==o.toLowerCase()||n||(r.push(e),n=!0)})})}),r.length<1&&this.reportError("There are no closely related posts"),r},e.prototype.reportError=function(e){this.options.debug&&t(this.element).append(t("<li>"+e+"</li>"))},t.fn.ghostRelated=function(t){return this.each(function(){new e(this,t)})}}(jQuery);